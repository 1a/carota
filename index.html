<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="carota-min.js"></script>
    <style>
        #exampleToolbar {
            position: absolute;
            left: 10px;
            top: 10px;
            right: 10px;
            height: 30px;
        }

        #exampleEditor {
            border: 1px solid silver;
            position: absolute;
            left: 10px;
            top: 40px;
            right: 10px;
            bottom: 10px;
        }

        button img {
            width: 12px;
            height: 12px;
        }
    </style>
</head>
<body>
    <div id="exampleToolbar">
        <select id="font">
            <option>Helvetica</option>
            <option>Times</option>
            <option>Georgia</option>
            <option>Courier</option>
        </select>
        <select id="size">
            <option>8</option>
            <option>9</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>14</option>
            <option>16</option>
            <option>18</option>
            <option>20</option>
            <option>24</option>
            <option>36</option>
            <option>72</option>
        </select>
        <label><input type="checkbox" id="bold"> <strong>B</strong></label> |
        <label><input type="checkbox" id="italic"> <em>i</em></label> |
        <label><input type="checkbox" id="underline"> <u>u</u></label> |
        <label><input type="checkbox" id="strikeout"> <strike>s</strike></label>
        <select id="align">
            <option value="left">Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
            <option value="justify">Justify</option>
        </select>
        <select id="script">
            <option value="normal">Normal</option>
            <option value="super">Superscript</option>
            <option value="sub">Subscript</option>
        </select>
        <select id="color">
            <option value="black">Black</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
        </select>
        <button id="smiley"><img src="smiley.png"></button>
    </div>

    <div id="exampleEditor"></div>

    <script>
    window.onload = function() {
        var elem = document.querySelector('#exampleEditor');
        var exampleEditor = carota.editor.create(elem);

        // Set up our custom inline - a smiley emoji
        var smiley = document.querySelector('#smiley img');
        exampleEditor.document.inlines = function(obj) {
            if (obj.smiley) {
                return {
                    measure: function(/*measureText*/) {
                        return {
                            width: 24,
                            ascent: 24,
                            descent: 0
                        };
                    },
                    draw: function(ctx, x, y, width, ascent, descent) {
                        ctx.drawImage(smiley, x, y - ascent, width, ascent);
                    }
                }
            }
        };

        // Inserting the inline
        carota.dom.handleEvent(document.querySelector('#smiley'), 'click', function() {
            exampleEditor.document.insert({ smiley: true });
        });


        // Wire up the toolbar controls
        ['font', 'size', 'bold', 'italic', 'underline',
         'strikeout', 'align', 'script', 'color'].forEach(function(id) {
            var elem = document.querySelector('#' + id);

            // When the control changes value, update the selected range's formatting
            carota.dom.handleEvent(elem, 'change', function() {
                var range = exampleEditor.document.selectedRange();
                var formatting = {};
                var val = elem.nodeName === 'INPUT' ? elem.checked : elem.value;
                formatting[id] = val;
                range.setFormatting(formatting);
                exampleEditor.paint();
            });

            // When the selected range coordinates change, update the control
            exampleEditor.selectionChanged(function(getFormatting) {
                var formatting = getFormatting();
                var val = id in formatting ? formatting[id] : carota.measure.defaultFormatting[id];
                if (elem.nodeName === 'INPUT') {
                    if (val === carota.runs.multipleValues) {
                        elem.indeterminate = true;
                    } else {
                        elem.indeterminate = false;
                        elem.checked = val;
                    }
                } else {
                    elem.value = val;
                }
            });
        });

        var sampleText = [
            { text: 'Welcome!', size: 20, bold: true },
            { text: '\n\nYou\'ve found the demo page for '
            },
            { text: 'Carota', size: 14, bold: true, color: 'orange' },
            { text: ', a rich text editor implemented in JavaScript ' +
                    'that uses HTML5 Canvas for rendering.'
            },
            { text: '\n\nAt runtime Carota has ' },
            { text: 'no external dependencies', bold: true },
            { text: '. You just pull in the carota-min.js ' +
                    'using the SCRIPT tag and away you go. Or else get node and use:\n\n' },
            { text: '    npm install carota', font: 'Courier' },
            { text: '\n\nto get the full source.' },
        ];

        exampleEditor.load(sampleText);
    };
    </script>
</body>
</html>
